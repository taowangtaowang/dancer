<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.wt.overflow.dao.SysUserMapper" >
  <resultMap id="BaseResultMap" type="com.wt.overflow.bean.SysUser" >
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="account" jdbcType="VARCHAR" property="account" />
    <result column="realName" jdbcType="VARCHAR" property="realname" />
    <result column="nickName" jdbcType="VARCHAR" property="nickname" />
    <result column="headIcon" jdbcType="VARCHAR" property="headicon" />
    <result column="gender" jdbcType="INTEGER" property="gender" />
    <result column="birthday" jdbcType="TIMESTAMP" property="birthday" />
    <result column="mobilePhone" jdbcType="VARCHAR" property="mobilephone" />
    <result column="email" jdbcType="VARCHAR" property="email" />
    <result column="weChat" jdbcType="VARCHAR" property="wechat" />
    <result column="managerId" jdbcType="VARCHAR" property="managerid" />
    <result column="securityLevel" jdbcType="INTEGER" property="securitylevel" />
    <result column="signature" jdbcType="VARCHAR" property="signature" />
    <result column="organizeId" jdbcType="VARCHAR" property="organizeid" />
    <result column="departmentId" jdbcType="VARCHAR" property="departmentid" />
    <result column="roleId" jdbcType="VARCHAR" property="roleid" />
    <result column="dutyId" jdbcType="VARCHAR" property="dutyid" />
    <result column="jobNumber" jdbcType="VARCHAR" property="jobnumber" />
    <result column="isAdministrator" jdbcType="INTEGER" property="isadministrator" />
    <result column="sortCode" jdbcType="INTEGER" property="sortcode" />
    <result column="deleteMark" jdbcType="INTEGER" property="deletemark" />
    <result column="enabledMark" jdbcType="INTEGER" property="enabledmark" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="creatorTime" jdbcType="TIMESTAMP" property="creatortime" />
    <result column="creatorUserId" jdbcType="VARCHAR" property="creatoruserid" />
    <result column="lastModifyTime" jdbcType="TIMESTAMP" property="lastmodifytime" />
    <result column="lastModifyUserId" jdbcType="VARCHAR" property="lastmodifyuserid" />
    <result column="deleteTime" jdbcType="TIMESTAMP" property="deletetime" />
    <result column="deleteUserId" jdbcType="VARCHAR" property="deleteuserid" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    id, account, realName, nickName, headIcon, gender, birthday, mobilePhone, email,
    weChat, managerId, securityLevel, signature, organizeId, departmentId, roleId, dutyId,
    jobNumber, isAdministrator, sortCode, deleteMark, enabledMark, description, creatorTime,
    creatorUserId, lastModifyTime, lastModifyUserId, deleteTime, deleteUserId
  </sql>
  
  <select id="queryByLoginName"  parameterType="java.util.Map" resultType="com.wt.overflow.bean.SysUser">
    select 
    a.id, a.account, a.realName, a.nickName, a.headIcon, a.gender, a.birthday,
	a.mobilePhone, a.email, a.weChat, a.managerId, a.securityLevel, a.signature,
	a.organizeId, a.departmentId, a.roleId, a.dutyId, a.isAdministrator, a.sortCode,
	a.deleteMark, a.enabledMark, a.description, a.creatorTime, a.creatorUserId, a.lastModifyTime,
	a.lastModifyUserId, a.deleteTime, a.deleteUserId, a.jobNumber,
	b.userPassword, b.question, b.answerQuestion, b.changePasswordDate
    from sys_user a left join sys_userlogon b on a.id = b.userId
    where account = #{loginname,jdbcType=VARCHAR} and a.deleteMark=0
  </select> 
  
  <update id="updateSysUserHeadIcon" parameterType="java.util.Map" >
    	update  sys_user set  F_HeadIcon = #{headIcon,jdbcType=VARCHAR}   where F_Id = #{fId,jdbcType=VARCHAR}
  </update>
  
  <select id="queryUserByPage" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select 
    <include refid="Base_Column_List" />
    from sys_user 
    <where>	
    	 F_Account != 'admin' and F_DeleteMark = 0
    	<if test="keyword != null and keyword !='' ">
				and (F_Account like ('%'+#{keyword}+'%')
				or F_RealName like ('%'+#{keyword}+'%')
				or F_MobilePhone like ('%'+#{keyword}+'%') ) 
		</if>
    </where>
    <if test=" sidx!=null and sidx!='' ">
	   order by  ${sidx}  ${sord} 
    </if>
  </select>

  <update id="deleteSysUser" parameterType="java.util.Map" >
    update  sys_user set  F_DeleteMark = 1, F_DeleteUserId =#{F_DeleteUserId,jdbcType=VARCHAR} ,F_DeleteTime =#{F_DeleteTime,jdbcType=TIMESTAMP} 
    where F_Id = #{fId,jdbcType=VARCHAR}
  </update>
  
   <update id="updateSysUserEnabled" parameterType="java.util.Map" >
    update  sys_user set  F_EnabledMark = #{F_EnabledMark,jdbcType=BIT} , F_LastModifyUserId =#{F_LastModifyUserId,jdbcType=VARCHAR} ,F_LastModifyTime =#{F_LastModifyTime,jdbcType=TIMESTAMP} 
    where F_Id = #{fId,jdbcType=VARCHAR}
  </update>
  
  <update id="updateSysUserReset" parameterType="java.util.Map" >
    update  sys_user set  F_Account = #{F_Account,jdbcType=BIT} , F_RealName = #{F_RealName,jdbcType=BIT} , 
    		F_LastModifyUserId =#{F_LastModifyUserId,jdbcType=VARCHAR} ,
    		F_LastModifyTime =#{F_LastModifyTime,jdbcType=TIMESTAMP} 
    where F_Id = #{fId,jdbcType=VARCHAR}
  </update>
  
  
  <select id="queryOneBySysUserId" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from sys_user
    where F_Id = #{keyValue,jdbcType=VARCHAR}
  </select>
  
  <select id="querySysUserByOrganId" resultMap="BaseResultMap" parameterType="com.wt.overflow.bean.SysUser" >
    select 
    <include refid="Base_Column_List" />
    from sys_user
    where F_OrganizeId = #{fOrganizeid,jdbcType=VARCHAR}
  </select>
  	
  <insert id="addSysUser" parameterType="com.wt.overflow.bean.SysUser" >
    insert into sys_user
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="fId != null" >
        F_Id,
      </if>
      <if test="fAccount != null" >
        F_Account,
      </if>
      <if test="fRealname != null" >
        F_RealName,
      </if>
      <if test="fNickname != null" >
        F_NickName,
      </if>
      <if test="fHeadicon != null" >
        F_HeadIcon,
      </if>
      <if test="fGender != null" >
        F_Gender,
      </if>
      <if test="fBirthday != null" >
        F_Birthday,
      </if>
      <if test="fMobilephone != null" >
        F_MobilePhone,
      </if>
      <if test="fEmail != null" >
        F_Email,
      </if>
      <if test="fWechat != null" >
        F_WeChat,
      </if>
      <if test="fManagerid != null" >
        F_ManagerId,
      </if>
      <if test="fSecuritylevel != null" >
        F_SecurityLevel,
      </if>
      <if test="fSignature != null" >
        F_Signature,
      </if>
      <if test="fOrganizeid != null" >
        F_OrganizeId,
      </if>
      <if test="fDepartmentid != null" >
        F_DepartmentId,
      </if>
      <if test="fRoleid != null" >
        F_RoleId,
      </if>
      <if test="fDutyid != null" >
        F_DutyId,
      </if>
      <if test="fIsadministrator != null" >
        F_IsAdministrator,
      </if>
      <if test="fSortcode != null" >
        F_SortCode,
      </if>
      <if test="fDeletemark != null" >
        F_DeleteMark,
      </if>
      <if test="fEnabledmark != null" >
        F_EnabledMark,
      </if>
      <if test="fDescription != null" >
        F_Description,
      </if>
      <if test="fCreatortime != null" >
        F_CreatorTime,
      </if>
      <if test="fCreatoruserid != null" >
        F_CreatorUserId,
      </if>
      <if test="fLastmodifytime != null" >
        F_LastModifyTime,
      </if>
      <if test="fLastmodifyuserid != null" >
        F_LastModifyUserId,
      </if>
      <if test="fDeletetime != null" >
        F_DeleteTime,
      </if>
      <if test="fDeleteuserid != null" >
        F_DeleteUserId,
      </if>
      <if test="fJobNumber != null" >
        F_JobNumber,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="fId != null" >
        #{fId,jdbcType=VARCHAR},
      </if>
      <if test="fAccount != null" >
        #{fAccount,jdbcType=VARCHAR},
      </if>
      <if test="fRealname != null" >
        #{fRealname,jdbcType=VARCHAR},
      </if>
      <if test="fNickname != null" >
        #{fNickname,jdbcType=VARCHAR},
      </if>
      <if test="fHeadicon != null" >
        #{fHeadicon,jdbcType=VARCHAR},
      </if>
      <if test="fGender != null" >
        #{fGender,jdbcType=BIT},
      </if>
      <if test="fBirthday != null" >
        #{fBirthday,jdbcType=TIMESTAMP},
      </if>
      <if test="fMobilephone != null" >
        #{fMobilephone,jdbcType=VARCHAR},
      </if>
      <if test="fEmail != null" >
        #{fEmail,jdbcType=VARCHAR},
      </if>
      <if test="fWechat != null" >
        #{fWechat,jdbcType=VARCHAR},
      </if>
      <if test="fManagerid != null" >
        #{fManagerid,jdbcType=VARCHAR},
      </if>
      <if test="fSecuritylevel != null" >
        #{fSecuritylevel,jdbcType=INTEGER},
      </if>
      <if test="fSignature != null" >
        #{fSignature,jdbcType=VARCHAR},
      </if>
      <if test="fOrganizeid != null" >
        #{fOrganizeid,jdbcType=VARCHAR},
      </if>
      <if test="fDepartmentid != null" >
        #{fDepartmentid,jdbcType=VARCHAR},
      </if>
      <if test="fRoleid != null" >
        #{fRoleid,jdbcType=VARCHAR},
      </if>
      <if test="fDutyid != null" >
        #{fDutyid,jdbcType=VARCHAR},
      </if>
      <if test="fIsadministrator != null" >
        #{fIsadministrator,jdbcType=BIT},
      </if>
      <if test="fSortcode != null" >
        #{fSortcode,jdbcType=INTEGER},
      </if>
      <if test="fDeletemark != null" >
        #{fDeletemark,jdbcType=BIT},
      </if>
      <if test="fEnabledmark != null" >
        #{fEnabledmark,jdbcType=BIT},
      </if>
      <if test="fDescription != null" >
        #{fDescription,jdbcType=VARCHAR},
      </if>
      <if test="fCreatortime != null" >
        #{fCreatortime,jdbcType=TIMESTAMP},
      </if>
      <if test="fCreatoruserid != null" >
        #{fCreatoruserid,jdbcType=VARCHAR},
      </if>
      <if test="fLastmodifytime != null" >
        #{fLastmodifytime,jdbcType=TIMESTAMP},
      </if>
      <if test="fLastmodifyuserid != null" >
        #{fLastmodifyuserid,jdbcType=VARCHAR},
      </if>
      <if test="fDeletetime != null" >
        #{fDeletetime,jdbcType=TIMESTAMP},
      </if>
      <if test="fDeleteuserid != null" >
        #{fDeleteuserid,jdbcType=VARCHAR},
      </if>
      <if test="fJobNumber != null" >
        #{fJobNumber,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>	
  
  <update id="updateSysUser" parameterType="com.wt.overflow.bean.SysUser" >
    update sys_user
    <set >
      <if test="fAccount != null" >
        F_Account = #{fAccount,jdbcType=VARCHAR},
      </if>
      <if test="fRealname != null" >
        F_RealName = #{fRealname,jdbcType=VARCHAR},
      </if>
      <if test="fNickname != null" >
        F_NickName = #{fNickname,jdbcType=VARCHAR},
      </if>
      <if test="fHeadicon != null" >
        F_HeadIcon = #{fHeadicon,jdbcType=VARCHAR},
      </if>
      <if test="fGender != null" >
        F_Gender = #{fGender,jdbcType=BIT},
      </if>
      <if test="fBirthday != null" >
        F_Birthday = #{fBirthday,jdbcType=TIMESTAMP},
      </if>
      <if test="fMobilephone != null" >
        F_MobilePhone = #{fMobilephone,jdbcType=VARCHAR},
      </if>
      <if test="fEmail != null" >
        F_Email = #{fEmail,jdbcType=VARCHAR},
      </if>
      <if test="fWechat != null" >
        F_WeChat = #{fWechat,jdbcType=VARCHAR},
      </if>
      <if test="fManagerid != null" >
        F_ManagerId = #{fManagerid,jdbcType=VARCHAR},
      </if>
      <if test="fSecuritylevel != null" >
        F_SecurityLevel = #{fSecuritylevel,jdbcType=INTEGER},
      </if>
      <if test="fSignature != null" >
        F_Signature = #{fSignature,jdbcType=VARCHAR},
      </if>
      <if test="fOrganizeid != null" >
        F_OrganizeId = #{fOrganizeid,jdbcType=VARCHAR},
      </if>
      <if test="fDepartmentid != null" >
        F_DepartmentId = #{fDepartmentid,jdbcType=VARCHAR},
      </if>
      <if test="fRoleid != null" >
        F_RoleId = #{fRoleid,jdbcType=VARCHAR},
      </if>
      <if test="fDutyid != null" >
        F_DutyId = #{fDutyid,jdbcType=VARCHAR},
      </if>
      <if test="fIsadministrator != null" >
        F_IsAdministrator = #{fIsadministrator,jdbcType=BIT},
      </if>
      <if test="fSortcode != null" >
        F_SortCode = #{fSortcode,jdbcType=INTEGER},
      </if>
      <if test="fDeletemark != null" >
        F_DeleteMark = #{fDeletemark,jdbcType=BIT},
      </if>
      <if test="fEnabledmark != null" >
        F_EnabledMark = #{fEnabledmark,jdbcType=BIT},
      </if>
      <if test="fDescription != null" >
        F_Description = #{fDescription,jdbcType=VARCHAR},
      </if>
      <if test="fCreatortime != null" >
        F_CreatorTime = #{fCreatortime,jdbcType=TIMESTAMP},
      </if>
      <if test="fCreatoruserid != null" >
        F_CreatorUserId = #{fCreatoruserid,jdbcType=VARCHAR},
      </if>
      <if test="fLastmodifytime != null" >
        F_LastModifyTime = #{fLastmodifytime,jdbcType=TIMESTAMP},
      </if>
      <if test="fLastmodifyuserid != null" >
        F_LastModifyUserId = #{fLastmodifyuserid,jdbcType=VARCHAR},
      </if>
      <if test="fDeletetime != null" >
        F_DeleteTime = #{fDeletetime,jdbcType=TIMESTAMP},
      </if>
      <if test="fDeleteuserid != null" >
        F_DeleteUserId = #{fDeleteuserid,jdbcType=VARCHAR},
      </if>
      <if test="fJobNumber != null" >
        F_JobNumber = #{fJobNumber,jdbcType=VARCHAR},
      </if>
    </set>
    where F_Id = #{fId,jdbcType=VARCHAR}
  </update>
  
   <select id="selectAllExitSysUsers" resultMap="BaseResultMap">
    select 
        <include refid="Base_Column_List" />
    from 
        sys_user 
    where 
        F_DeleteMark=0 
  </select>

  <select id="selectWindowsUserList" resultMap="BaseResultMap">
    select u.F_Id, u.F_Account, u.F_RealName from Sys_User u
    left join rn_organbusinesstype t on u.F_OrganizeId = t.OrganId
    where t.BusinessTypeId = #{businessTypeId} and t.DeleteMark = 0 and t.EnabledMark =1
    and u.F_DeleteMark = 0 and u.F_EnabledMark =1 and
    not exists(select 1 from rn_businesswindows w where w.DeleteMark = 0 and w.EnabledMark = 1
    and w.CurrentLoginUser != '' and u.F_Id like '%'+w.CurrentLoginUser+'%')
    order by u.F_SortCode asc
  </select>
</mapper>