<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>绵阳一体化政务服务考勤系统</title>

<script src="../../Content/js/jquery/jquery-2.1.1.min.js"></script>
<script src="../../Content/js/bootstrap/bootstrap.js"></script>
<link href="../../Content/js/bootstrap/bootstrap.min.css"
	rel="stylesheet" />
<script src="../../Content/js/wdtree/tree.js"></script>
<link href="../../Content/js/select2/select2.min.css" rel="stylesheet" />
<script src="../../Content/js/select2/select2.min.js"></script>
<script src="../../Content/js/wizard/wizard.js"></script>
<script src="../../Content/js/validate/jquery.validate.min.js"></script>
<script src="../../Content/js/datepicker/WdatePicker.js"></script>
<link href="../../Content/css/framework-ui.css" rel="stylesheet" />
<script src="../../Content/js/work.js"></script>
<link href="../../Content/css/my_kq.css" rel="stylesheet" />


<script>
$(function () {
	//角色加载
	$.loadlist("users","fId","fFullname","/role/queryRoleByPage");
	//流程设定加载
	$.loadlist("process","fId","fFullname","/role/queryRoleByPage");
	//自动备案加载
	$.loadlist("record","fId","fFullname","/role/queryRoleByPage");
	//加载配置集合
	$.configlist();

	//流程设定
	$("#process_add").click(function(){
		var result=$('#process option:selected').text();
		var pd=$("#process_se").text();
		if(result == "―请选择―"){
			$.modalAlert("请选择正确的数据！","error");
			return;
		}
		if(pd.indexOf(result) >= 0 ) { 
		    $.modalAlert("请勿重复选择！","error");
		    return;
		} 
		var resultid=$('#process option:selected').val();
		var pds=$("#process_ses").text();
		var resultsid="";
		if(pds.length==0){
			resultsid=resultid+"_";
		}else{
			resultsid=pds+resultid+"_";
		}
		var results=pd+"→"+result+"（考勤管理人/督察管理人员）";
		$("#process_se").html(results);
		$("#process_ses").text(resultsid);
	});
	//自动备案
	$("#record_add").click(function(){
		var result=$('#record option:selected').text();
		var pd=$("#record_se").text();
		if(result == "―请选择―"){
			$.modalAlert("请选择正确的数据！","error");
			return;
		}
		if(pd.indexOf(result) >= 0 ) { 
			$.modalAlert("请勿重复选择！","error");
		    return;
		} 
		var resultid=$('#record option:selected').val();
		var pds=$("#record_ses").text();
		var results=pd+"→"+result+"（备案）";
		var resultsid="";
		if(pds.length==0){
			resultsid=resultid+"_";
		}else{
			resultsid=pds+resultid+"_";
		}
		$("#record_se").html(results);
		$("#record_ses").text(resultsid);
	});
	
	//添加数据
	$("#inwork_pei").click(function(){
		
		var user=$('#users option:selected').val();
		var record=$("#record_se").text();
		var process=$("#process_se").text();
		var times=$('#time option:selected').val();
		if(user=="0" || record.length==0 || process.length==0 || times=="0"){
			$.modalAlert("填写数据不完善！","error");
			return;
		}
		var FlowStr=$('#users option:selected').text()+":("+$('#time option:selected').text()+")前台 "+process+record;
		var flowStrUUID=$("#process_ses").text();
		var OnRecordRoleId=$("#record_ses").text();
		var Data={
			    "FlowStr":FlowStr,//1天及以内-张三-李四-王五（  -  隔开）（该字段为流程展示）
				"MaxDays":$('#time option:selected').val(),//2种选择  1天及以内（传1）    一天以上（传-99）
				"LeaverRoleId":$('#users option:selected').val(),//请假人角色id
				"flowStrUUID":flowStrUUID,//请假审核流程角色 id（用_隔开）
				"OnRecordRoleId":OnRecordRoleId//请假备案角色 id（用_隔开）
	             };
	   $.ajax({
            url: $.sysStaticData().urlExt +"/lvApprovalFlow/addlvApprovalFlow",
            data: Data,
            type: "post",
            dataType: "json",
            success: function (data) {
                if (data.state == "success") {
                	$.modalAlert("添加成功！","success");
                    window.location.reload();
                }else {
                	$.modalAlert(data.message,"error");
                }
             }
            });
		
	});
	
})

function deletes(value){
	$.ajax({
		url: $.sysStaticData().urlExt +"/lvApprovalFlow/deleteLvApprovalFlow",
        data:{"id":value},
        type: "post",
        dataType: "json",
        success: function (data) {
        	if (data.state == "success") {
        		$.modalAlert("删除成功！","success");
                window.location.reload();
            }else {
            	$.modalAlert("删除成功！","error");
            }
        }
	});
}
</script>
</head>

<body>
	<div class="ck_div">
		<div class="tab_nav">
			<ul>
				<li class="dq"><a href="#" target="_parent">流程设定</a></li>
			</ul>
			<div class="clr"></div>
		</div>
		<div class="tab_con">
			<div class="co_con_big" style="padding-top: 0;">
				<div class="mb20 co_tl">流程设定</div>
				<div class="co_con_a">
					<div class="sc_in_group">
						<label class="tc03"><span class="tsclass">*</span>角色：</label> <select class="input-ss in-u-s-1"
							id="users">
							<option value="0">―请选择角色―</option>
						</select>
					</div>
					<div class="sc_in_group">
						<label class="tc03"><span class="tsclass">*</span>时限：</label> <select class="input-ss in-u-s-1"
							id="time">
							<option value="0">―请选择时限―</option>
							<option value="1">一天及一天以内</option>
							<option value="-99">一天以上</option>
						</select>
					</div>
					<div class="sc_in_group">
						<label class="tc03"><span class="tsclass">*</span>流程设定：</label> <select
							class="input-ss in-u-s-1" id="process">
							<option>―请选择―</option>
						</select> <a href="#" class="btn_kq btn_tj" style="margin-left: 10px;"
							id="process_add">添加</a> <span
							style="margin-left: 20px; color: red;" id="process_se"></span> <input
							type="hidden" id="process_ses" value="" />
					</div>
					<div class="sc_in_group">
						<label class="tc03"><span class="tsclass">*</span>自动备案：</label> <select
							class="input-ss in-u-s-1" id="record">
							<option>―请选择―</option>
						</select> <a href="#" id="record_add" class="btn_kq btn_tj"
							style="margin-left: 10px;">添加</a> <span
							style="margin-left: 20px; color: red;" id="record_se"></span> <input
							type="hidden" id="record_ses" value="" />
					</div>
					<div class="sc_in_group">
						<label class="tc03">&nbsp;</label> <a class="btn_kq btn_sea"
							id="inwork_pei">确定</a>
					</div>
					<div class="clr"></div>
				</div>
			</div>
			<div class="co_con_big" style="border-bottom: none;">
				<div class="mb20 co_tl">已配置流程</div>
				<div class="co_con_a">
					<div class="sc_in_group">
						<ul id="config">
						</ul>
					</div>
					<div class="clr"></div>
				</div>
			</div>
		</div>
		<div class="clr"></div>
	</div>
</body>
</html>
