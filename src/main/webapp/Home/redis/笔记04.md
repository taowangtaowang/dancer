**分布式redis**

redis实践应用
    redis是如何解决数据一致性问题？
    
    分布式锁（redis，zk实现）
        redis.UnitTest/redis.RedissonLock  jedis.setnx
    redis单点的管道模式
        redis.PipelineDemo
    
    Redis缓存与数据一致性问题？
        那么基于这个出发点，问题就来了，当用户的余额发生变化的时候，如何更新缓存中的数据，也就是说。
            1  我是先更新缓存中的数据再更新数据库的数据；
            2  还是修改数据库中的数据再更新缓存中的数据
               这就是我们经常会在面试遇到的问题，数据库的数据和缓存中的数据如何达到一致性？首先，可以肯定的是，
            redis中的数据和数据库中的数据不可能保证事务性达到统一的，这个是毫无疑问的，所以在实际应用中，我们都
            是基于当前的场景进行权衡降低出现不一致问题的出现概率。
        更新缓存还是让缓存失效？
            衡量的指标：
                1  如果更新缓存的代价很小，那么可以先更新缓存，这个代价很小的意思是我不需要很复杂的计算去获得最新的余额数字。
                2  如果是更新缓存的代价很大，意味着需要通过多个接口调用和数据查询才能获得最新的结果，那么可以先淘汰缓存。
                    淘汰缓存以后后续的请求如果在缓存中找不到，自然去数据库中检索。
        先操作数据库还是先操作缓存？    
            1  先更新数据库再让缓存失效
            2  先让缓存失效，再更新数据库
            最终一致性的解决方案：
                给一个自身队列的方式，自己生产，自己消费  如果消费失败（更新数据成功，缓存失效）则能主观的进行数据缓存管理
                
    关于缓存雪崩的解决方案？
            缓存雪崩是指设置缓存时采用了相同的过期时间，导致缓存在某一个时刻同时失效，或者缓存服务器宕机宕机导致缓存全面失效，
        请求全部转发到了DB层面，DB由于瞬间压力增大而导致崩溃。缓存失效导致的雪崩效应对底层系统的冲击是很大的。     
        解决方式：
            1  对缓存的访问，如果发现从缓存中取不到值，那么通过加锁或者队列的方式保证缓存的单进程操作，从而避免
               失效时并发请求全部落到底层的存储系统上；但是这种方式会带来性能上的损耗
            2  将缓存失效的时间分散，降低每一个缓存过期时间的重复率
            3  如果是因为缓存服务器故障导致的问题，一方面需要保证缓存服务器的高可用、另一方面，应用程序中可以采
               用多级缓存       
    缓存穿透击穿的解决方案？
            缓存穿透是指查询一个根本不存在的数据（恶意请求），缓存和数据源都不会命中。出于容错的考虑，如果从数据层查不到数据
        则不写入缓存，即数据源返回值为 null 时，不缓存 null。缓存穿透问题可能会使后端数据源负载加大，由于很多后
        端数据源不具备高并发性，甚至可能造成后端数据源宕掉
        解决方式：
            1   如果查询数据库也为空，直接设置一个默认值存放到缓存，这样第二次到缓冲中获取就有值了，而不会继续访
                问数据库，这种办法最简单粗暴。比如，”key” , “&&”。
                在返回这个&&值的时候，我们的应用就可以认为这是不存在的key，那我们的应用就可以决定是否继续等待继续访
                问，还是放弃掉这次操作。如果继续等待访问，过一个时间轮询点后，再次请求这个key，如果取到的值不再是
                &&，则可以认为这时候key有值了，从而避免了穿透到数据库，从而把大量的类似请求挡在了缓存之中。
            2   根据缓存数据Key的设计规则，将不符合规则的key进行过滤
                采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的BitSet中，不存在的数据将会被拦截掉，从而避免了
                对底层存储系统的查询压力
                 
    布隆过滤器原理：
        jedis和 redisson都有提供布隆过滤器
        <具体原理后续再整理>               
                  